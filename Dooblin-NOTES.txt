Описание геймплея
file:///d:/Unity3D4.3/Client_Grabli/!DOCS/Dooblin-GP.txt

TODO list
file:///d:/Unity3D4.3/Client_Grabli/!DOCS/Dooblin-TSKLST.txt


17:09 08.02.2014
	Продолжаю работы с сетью Unity.
	Фотонклауд врут на сайте про свои отличия от юньки. Основной упор делают на то что игровой сервер(комнату) создает кто угодно и если он выйдет - то комната исчезнет. Взамен предлагают создавать комнаты у них, но без игровой логики. А для полноценной работы нужно скачать их сервер, написать для него логику и запустить на собстевенном оплаченом сервере VDS или DS. Лажа. То же самое я уже делаю на юне. И задаром.
	Перевел систему на SyncMessage. Для работы нужно на сервере не только принимать информацию от сендера но и отправлять ее дальше по клиентам. При пересылке данных с сервера отправитель не получает копии, что и правильно.
	С помощь SyncMessage я могу полность контролировать объем отправляемой информации. Например, если игрок далеко ото всех, то можно слать данные раз в 10 сек. Или данные от игрока на сервер идут с одной частотой, а сервер рассылает инфу как посчитает нужным и т.д.
	На стороне сервера можно изменять NetworkView.SetScope(). При загрузке уровня на клиенте можно выключать Network.SetSendingEnabled(), тогда клиент не будет посылать никому никаких сообщений. Но тогда не будет возможности включить ее с сервера. Только сам клиент может опомниться и начать передавать данные. Для работы со стороны сервера нужно пользоваться Network.SetReceivingEnabled()

14:11 12.02.2014
	Функциональность компонентная, Поведение автоматное.

0:51 13.02.2014
	Ура. Автоматы - это просто единственный возможный вариант для правильного и удобного программирования сети. Вот сегодня сделал свой первый автомат для пулемета. Забавно :) Смысл в том, чтобы игрок у себя имел только пульт управления от пушки на сервере. Т.е. две кнопки: Огонь и Перезарядка. А на сервере уже сама пушка реализованная на стейт-машине обрабатывала эти команды.
	После реализации остались только самые лучшие впечатления. Код ясный и понятный и мне кажется будет легким в соправождении. Итог: реализавал стрельбу, перезарядку, отображение патронов. Урон и изображение урона сделал днем раньше, но думаю стоит перевести его тоже на автомат. Вчера арендовал выделенный виртуальные сервер на Убунте. Все заработало просто на ура. И Мастер сервер и игровой. Все протестил. Посещаемость и подписки на ВКонтакте нулевые.

10:10 13.02.2014
	Короче. Тащим по взрослому. Интересно, если просто набросать кучу игровых механик  без души и великого смысла, будет ли народ играть?
	У меня первый подписчик в игре. http://vk.com/sergzv22 Сергей Завьялов. Странно, что в группу не подписался. А вот за ночь, что-то случилось с игровым сервером пришлось перезагружать. После перезагрузки все заработало. Проблема. Сразу вспомнился "Ночной продавец". "Человек под дождем прет в магазин... а магизин закрыт!". Хорошее кино.

9:42 14.02.2014
	Вчера целый день просидел над регистрацией ВКонтакте. Документация конечно хреново написана. Но и сам тупил. И конечно-же дает о себе знать переход на питон. Долго искал как получить в программу параметры адресной строки. Затем как парсить полученное в адресе и в запросе ну и там по мелочи. 
	Сервак работает пока стабильно. Сутки уже простоял.

10:32 15.02.2014
	Вчера был 14 февраль. Нифига не далал. Проводил время вдвоем.
	Опять падает сервак. Хотя я грешу на способ запуска. Все-таки линуксоид я пока начинающий. Вчера попробовал утилиту Screen. Пол суток уже стоит и не падает. Ждем.
	Считаю необходимым кроме технических деталей уделять время геймплею. Вот прям как пробежка трусцой - неохота, но без этого никуда. Хотя бы на бумаге. Т.к. наблюдается странная тенденция - мир растет, а смысла в нем не прибавляется. Вот здесь и встает вопрос о расширении штата с меня одного до сколько необходимо. А то у меня даже первый подписчик уже отписался :(

10:35 17.02.2014
	Вчера сделал чат из Web в Unity. Сервак до сих пор не упал. Хорошо. Нехватка знаний по web-python технологиям дает о себе знать. За весь день создано 4 файла по 10 строчек в каждом. Если бы не отличная архитектура, то процесс бы вообще затянулся.
	Все время думаю об игровом цикле. Хотя бы минимальном.
	Внес изменения в работу оружия на клиенте. Создал базовый класс для оружия. Теперь текущее оружие можно безболезненно менять. Система отображения статуса(патроны, обоймы, состояние и тд.) теперь обеспечивается этим базовым классом.

13:42 18.02.2014
	Посчитал трафик для 2000 человек в онлайне:
200 комнат 5х5 т.е коэффициент 10*9 = 900. Это без оптимизации по видимости.
Частота передачи 10 раз в секунду
Примерный размер пакета: Позиция(Vector3) + Поворот(Quaternion) + Поворот взгляда (Vector3) и все это умножим на 2(как японский строитель мостов) = (3+4+3)*2 = 20 байт.
ИТОГО: 200 * 900 * 10 * 20 = 3 600 000 байт в секунду = 3,433 Мбайт/с = 27,4 Мбит/сек. 

9:49 20.02.2014
	А вот и нет. На форуме заметили. Ошибся в (3+4+2) нужно умножать на 4 байта. Хотя это отличная идея перейти на fixed. НАпример использовать 10 бит  - 1024 на метры и 6 бит - 64 на единицы в метре. Т.е вся площадь будет разбита на квадранты по километру в каждом. Реально можно сократить синхронизирующий трафик в 2 раза. А если еще и кватернион заменить на Эйлера углы. То еще минус 2 байта. Блин - а что если для перемещения, например, передавать только дельту. При скорости 60 км/ч и частоте передачи 10 Гц. Максимальная дельта составит: 16.7 м/с / 10 Гц = 1.67 м. Тогда при использовании 10 бит на число точность составит 167см / 1024 = 0,16 см. Т.е. если объект двинется на 0,16 сантиметра - мы это засечем. Ну и плюс два бита для технических нужд (например, нумеровать пакеты для контроля). В итоге 4 байта на MoveDeltaVector3. Ну и конечно на клиенте необходимо вести учет нарастающей ошибки. И когда некий предел будеть достигнут слать точные значения. Надо будет обязательно попробовать.
	Далее. Вчера сделал ящички. Респавнятся с серверного файла. Кристина придумала поставить рядом с ящиками девчонок. Отличная идея. Т.к. мне очень не нравилось отсутствие людей на карте. Прям тоска такая. Одни стены и машины. А ведь людям нравится смотреть на других людей. Вон в социалках че творится одни фотки и плюсы к ним. Сегодня займусь патронами.

13:50 24.02.2014
	Опять празники. Держусь. Все сильней и сильней меня заворачивает на мысле о геймплее. Огромное количество игровых механик просто вводят меня в состояние ослика с сеном. Наступает время перехода к геймдизайну. Сегодня махнув рукой, решил создать первый игровой режим по зачистке территории - привет ZeroTolerance. Сделаю статичных ботов которые больно кидаются камнями - дикарей или одичавших (взамен зомби и мутантов)

17:28 25.02.2014
	Работаю над созданием режима Зачистка территории. Мозги ботов отделил от ИИ. ИИ управляется стимулами. Такой подход помогает при программировании. Само собой получилось разделение на серверную и клиентскую части. Т.е. тело со способностиями стоять, ходить, бежать, стрелять и т.д. на клиенте, а ИИ на сервере. Постоянно думаю о генетических ,итерационно обучающих алгоритмах. Наверное в следующей жизни попробую реализовать :) Сделал систему автоматического респавна ботов в заданном объеме. Объем задается визуально на карте. Постепенно добавляются инструменты для редактирования карты.
 http://www.mantisbt.org/ Ссылка на БагТрекер. Давно его видел уже.
 http://www.abstractspoon.com/tdl_resources.html Ссылка на TODO list

9:27 03.03.2014
	Сеть. 5 дней назад начал оптимизацию работы сети. Решение трудное, но необходимое. Всвязи с тем, что Unity считает необходимым посылать в каждом пакете 32 байта служебной информации (! для каждого пакета или для каждого NV? Необходимо проверить) и из-за того, что синхронизация всех NV в сети (дубликаты у пользователей) решено ввести режим полного контроля за частотой и содержимым-размером пакетов. Режим разделения. Синхронизация viewer должна быть полностью контролируемой. Пришлось много работать. Для ограничение использовал NetworkView.Scope() на сервере. Избавился от ошибки, когда при подключении игрок получал инфу от непродублированного у него NV. Теперь у игрока и сервера находятся по 2 NV.  Один принадлежит игроку и используется им для отправки пакетов, другой принадлежит серверу и используется дла отправки данных игроку.  Эти же NV используются для чтения, но в обратном порядке. Еще один (общий для всех игроков) NV принадлежащий серверу используется для вызова RPC.
	Уже 2 дня работаю над двоичным разбиением пространства. Буду использовать его для определения видимости игроков с целью оптимизации трафика. Попутно получается вокселизатор - его назначение пока не определено :)

10:56 08.03.2014
	Неделя. Деревья, вокселизаторы, деревья и снова двоичное разбиение. OpenGL, запросы на видимость геометрии, Умбра. В конце-концов буду использовать встроенное решение Unity для отсечения невидимой динамической геометрии, т.е. Умбра. Самое главное - комнаты. Сделал комнаты. Ограничение трафика и физики по комнатам. Игроки принадлежат комнатам. Архитектура позволила сделать комнаты, буквально, за 2 дня. Причем не особо напрягаясь. Архитекрура наше все. При 8 подключенных игроках в одной комнате трафик 24 Кбит/с. 300 байт/тик.
	И кучка мелких изменений. Камера не проходит сквозь стены. ГУИ для выбора комнат. Довел до ума чат - решил проблему с конечными '\n'. Теперь есть каналы. Каналы выделяются цветом. Стрельба раздается клиентам через UDP, и только клиент использует RPC. Ах, ну да. Координаты передаю как fixed16 - все отлично. Едем дальше.

10:32 16.03.2014
	3 дня на племянника. 1 день на покупку печки. Остальное время мысли о маркетинге и геймдизайне. Простматривал форумы, блоги, статьи. Вобщем аналитика. Рисую итерфейс в стиле милитари. Изучал технику рисованных текстур.
	РЕшил, что машина в игре должна быть как друг, собака, передвижная база поддержки. Она несет на себе тяжелое вооружения и обладает небольшим ИИ. Может осуществлять поддержку, например, защиту, лечение, радар и т.д. Идея с просто машиной мне кажется непригодной. После игры в ExMachine однозначно можно сказать, что мир наполненый ландшафтом и машинами неинтересен (даже нудный). Хотя, конечно, можно привести в пример ТанкиОнлайн. Но Танки - это мир населенный только людьми, где нет места НИП, игровые сессии очень короткие - это больше смахивает на аркадный атракцион (семечки, сканворды). Это я к тому, что Танки не ExMach, а не к тому, что все игры только с техникой скучные.

13:32 26.03.2014
	Разработал методику запекания текстур. Чтобы получить интересные эффекты по граням лоуполи модель должна иметь сглаженные нормали. Спекуляры рендерим отдельно Модели получаются просто профессионально. Сделал крутую пушку. Много работы по движку. Добавил интерфейс. В комнатах видно других игроков. Есть вход-выход из комнат. Игроки могут менять имя. При убийстве в чате появляется информация кто кого уничтожил.
Полностью переделал физику авто. Теперь использую WheelCollider. Теперь на консолях все летает. Модель стала полностью управляемой. Можно делать ускорители, прыжки и пр. Одним словом "контроль".

19:21 02.04.2014
	Написал щейдер для MentalRay для сглаженных углов - это просто огонь. Вместе с предыдущими наработками смотрится просто отлично. А, да. Про огонь. Наработал технику создания анимации и FX выстрела в Майке. Смотрится хорошо. Вообще все хорошо. Но. Надо зарабатывать деньги. Я переключаюсь на сайт салона красоты, блин. 
	От тоски отправил заявку в VK.com на регистрацию игры в каталоге.       Все время забываю сказать, что автомат для пулемета переделывался все это время постоянно. Но в результате допиливания реальной системы - видение автоматов теперь такое же как видиние тангенциального пространства после менталреевского шейдера. Кстати, нужно не забывать, что автомат еще и разнесен по сети - все непросто.
	С геймплея меня все время сворачивает на контент. Но уже легче. Когда чувстуешь силу в контенте - легче думать про геймплей. Если тылы прикрыты, начинаешь больше думать про игры вообще. Прям пирамида Маслова какая-то получается.



